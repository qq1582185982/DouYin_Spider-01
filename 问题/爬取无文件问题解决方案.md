# 爬取完成但无文件问题解决方案

## 问题描述
任务显示"已完成"，但设置的目录中没有任何文件。

## 问题原因
1. 测试版服务器（app_test.py）只是模拟任务，不会真正执行爬虫
2. Cookie未正确配置或已过期（最常见）
3. 爬虫模块未正确初始化
4. 抖音API返回"强制登录"错误（Cookie失效）

## 解决方案

### 1. 使用修复版服务器

停止当前的测试服务器，使用修复版：

```bash
# 停止app_test.py (Ctrl+C)
# 启动修复版服务器
python app_fixed.py
```

### 2. 配置Cookie

#### 方法一：通过Web界面配置（推荐）
1. 访问 http://localhost:5173/settings
2. 在Cookie输入框中粘贴你的抖音Cookie
3. 设置保存路径（如：D:/DouYin/Downloads）
4. 点击"保存配置"

#### 方法二：创建.env文件
1. 复制`.env.example`为`.env`
2. 编辑`.env`文件，填入你的Cookie：
```
DY_COOKIES=你的抖音Cookie
DY_LIVE_COOKIES=你的抖音直播Cookie
```

### 2.5 诊断Cookie问题

如果遇到"Expecting value: line 1 column 1 (char 0)"错误：
1. 运行诊断脚本：`python test_spider.py`
2. 查看日志文件：`debug_spider.log`
3. 如果看到"强制登录"或空响应，说明Cookie已过期

### 3. 获取Cookie的方法

1. 打开Chrome浏览器，访问 https://www.douyin.com
2. 登录你的账号
3. 按F12打开开发者工具
4. 切换到"Network"（网络）标签
5. 刷新页面
6. 找到任意一个请求，点击查看Headers
7. 找到Cookie字段，复制整个值

**重要**：确保Cookie包含以下关键字段：
- `s_v_web_id`（必须）
- `msToken`（必须）
- `UIFID` 或 `UIFID_TEMP`
- `passport_csrf_token`

### 4. 验证爬虫功能

1. 确保Cookie已配置
2. 在设置页面验证Cookie有效性
3. 尝试爬取一个用户：
   - 访问用户爬取页面
   - 输入用户主页URL
   - 选择保存方式
   - 点击"开始爬取"

### 5. 检查文件保存位置

默认保存路径：
- Windows: `./downloads/media`（视频/图片）
- Windows: `./downloads/excel`（Excel文件）

自定义路径：
- 在设置页面配置的路径下
- 例如：`D:/DouYin/Downloads/media`

### 6. 常见问题

**Q: 提示"请先配置Cookie"**
A: 在设置页面配置Cookie并保存

**Q: 任务一直是"运行中"**
A: 可能是Cookie无效或网络问题，检查控制台输出

**Q: 文件保存在哪里？**
A: 查看设置页面的"保存路径"，文件会保存在该路径的media和excel子目录中

**Q: 爬取失败显示错误**
A: 
- 检查Cookie是否过期
- 确保网络连接正常
- 查看控制台的详细错误信息

**Q: 出现"Expecting value: line 1 column 1 (char 0)"错误**
A: 这是Cookie过期的典型表现，抖音API返回了空响应。需要重新获取Cookie。

### 7. 测试建议

1. 先测试单个作品爬取
2. 使用较小的数量测试搜索功能
3. 确认文件正确保存后再进行批量操作

## 注意事项

- Cookie有时效性，过期需要重新获取
- 爬取速度不要太快，避免被限制
- 建议使用代理以提高稳定性
- 定期检查并更新Cookie